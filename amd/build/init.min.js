/*! amd 2021-04-26 */

define(["jquery","core/ajax","core/notification"],function(l,o){return{init:function(n="undefined"){function r(e){for(var d,t=window.location.search.substring(1).split("&"),a=0;a<t.length;a++)if((d=t[a].split("="))[0]===e)return d[1],decodeURIComponent(d[1]);return!1}l('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var t,a,i,s,d,e=(e=e.target.toString()).split("#");if(0!=e.length)switch(e[1]){case"highscores":!function(t="undefined"){var e=r("id"),t=t;l("#spinner div").removeClass("hidden"),l("#highscorestable").addClass("hidden");var a='<div style="margin-top: 20px;"><a class="btn btn-primary" href="view.php?id='+e+'&action=downloadhighscores">Download Highscores</a></div>';l("#spinner div").removeClass("hidden"),o.call([{methodname:"mod_mooduell_load_highscore_data",args:{quizid:e},done:function(e){var d="";e.forEach(e=>{d+='<tr><td class="text-right">'+e.rank+'</td><td class="text-left" >'+e.username+'</td><td class="text-right">'+e.gamesplayed+'</td><td class="text-right">'+e.gameswon+'</td><td class="text-right">'+e.gameslost+'</td><td class="text-right">'+e.score+'</td><td class="text-right">'+e.correct+'</td><td class="text-right">'+e.correctpercentage+"%</td></tr>"}),l("#highscorestable").html(d),"teacher"===t&&l("#hsdownloadbutton").html(a),l("#spinner div").addClass("hidden"),l("#highscorestable").removeClass("hidden")},fail:function(){l("#spinner div").addClass("hidden"),l("#highscorestable").removeClass("hidden")}}])}(n);break;case"questions":d=r("id"),l("#spinner div").removeClass("hidden"),l("#questionstable").addClass("hidden"),l("#spinner div").removeClass("hidden"),o.call([{methodname:"mod_mooduell_load_questions_data",args:{quizid:d},done:function(e){var s="";e.forEach(e=>{var d="no image";e.imageurl&&0<e.imageurl.length&&(d='<a href="'+e.imageurl+'"><img src="'+e.imageurl+'" alt="'+e.imagetext+'" width="100px"></img></a>');var t=e.length;t&&0!=t.length||(t=e.questiontext.length);var a="<ul>";e.warnings.forEach(e=>{a+='<li><span style="color:red;">'+e.message+"</span></li>"}),a+="</ul>";var i="<ul>";e.answers.forEach(e=>{var d=0<e.fraction?' style="font-weight:bold"':"";i+="<li><span"+d+">"+e.answertext+"</span></li>"}),s+='<tr><td><a href="../../question/question.php?returnurl=/question/edit.php?courseid='+e.courseid+"&courseid="+e.courseid+"&id="+e.questionid+'">'+e.questionid+"</a></td><td>"+d+'</td><td class="text-left">'+e.questiontext+(i+="</ul>")+'</td><td class="text-right">'+e.questiontype+'</td><td class="text-right">'+t+'</td><td class="text-right">'+e.category+'</td><td class="text-right">'+a+'</td><td class="text-right">'+e.status+"</td></tr>"}),l("#questionstable tbody").html(s),l("#spinner div").addClass("hidden"),l("#questionstable").removeClass("hidden")},fail:function(){l("#spinner div").addClass("hidden"),l("#questionstable").removeClass("hidden")}}]);break;case"opengames":[i="undefined"]=[n],s=r("id"),l("#spinner div").removeClass("hidden"),l("#opengamestable").addClass("hidden"),l("#spinner div").removeClass("hidden"),o.call([{methodname:"mod_mooduell_load_opengames_data",args:{quizid:s},done:function(e){var d="";e.forEach(e=>{d+="<tr><td>"+e.playera+"</td><td>"+e.playeraresults+"</td><td>"+e.playerb+"</td><td>"+e.playerbresults+"</td>","teacher"===i&&(d+='<td class="text-right"><a href="view.php?action=viewquestions&id='+s+"&gameid="+e.gameid+'" data-id="'+e.gameid+'" data-role="viewfield">view</a>\n                <a href="view.php?action=delete&id='+s+"&gameid="+e.gameid+'" data-id="'+e.gameid+'" data-role="deletefield">delete</a></td>'),d+="</tr>"}),l("#opengamestable tbody").html(d),l("#spinner div").addClass("hidden"),l("#opengamestable").removeClass("hidden")},fail:function(){l("#spinner div").addClass("hidden"),l("#opengamestable").removeClass("hidden")}}]);break;case"finishedgames":[t="undefined"]=[n],a=r("id"),l("#spinner div").removeClass("hidden"),l("#finishedgamestable").addClass("hidden"),l("#spinner div").removeClass("hidden"),o.call([{methodname:"mod_mooduell_load_finishedgames_data",args:{quizid:a},done:function(e){var d="";e.forEach(e=>{d+="<tr><td>"+e.playera+"</td><td>"+e.playeraresults+"</td><td>"+e.playerb+"</td><td>"+e.playerbresults+"</td>","teacher"===t&&(d+='<td class="text-right"><a href="view.php?action=viewquestions&id='+a+"&gameid="+e.gameid+'" data-id="'+e.gameid+'" data-role="viewfield">view</a>\n                <a href="view.php?action=delete&id='+a+"&gameid="+e.gameid+'" data-id="'+e.gameid+'" data-role="deletefield">delete</a></td>'),d+="</tr>"}),l("#finishedgamestable tbody").html(d),l("#spinner div").addClass("hidden"),l("#finishedgamestable").removeClass("hidden")},fail:function(){l("#spinner div").addClass("hidden"),l("#finishedgamestable").removeClass("hidden")}}])}}),r("gameid")&&(l("#spinner div").addClass("hidden"),l("#questionstable").removeClass("hidden"))}}});