/*! amd 2021-05-05 */

define(["jquery","core/ajax","core/notification"],function(g,f){return{init:function(){var a=function(e){for(var n,i=window.location.search.substring(1).split("&"),t=0;t<i.length;t++)if((n=i[t].split("="))[0]===e)return n[1],decodeURIComponent(n[1]);return!1};function l(n,e=null,i=null,t=null,a=null,s=null,d=null){g("#spinner div").removeClass("hidden"),g("#opengamestable").addClass("hidden"),g("#spinner div").removeClass("hidden"),f.call([{methodname:"mod_mooduell_load_opengames_data",args:{quizid:n,pageid:e,tsort:i,thide:t,tshow:a,tdir:s,treset:d},done:function(e){e=g(g.parseHTML(e.content));1!=e.length&&(m(0,e,"opengames"),c(n,e,l),h(n,e,l),u(n,e,l)),g("#spinner div").addClass("hidden"),g("#opengamestable").html(e),g("#opengamestable").removeClass("hidden")},fail:function(){alert("fail"),g("#spinner div").addClass("hidden"),g("#opengamestable").removeClass("hidden")}}])}function o(n,e=null,i=null,t=null,a=null,s=null,d=null){g("#spinner div").removeClass("hidden"),g("#finishedgamestable").addClass("hidden"),g("#spinner div").removeClass("hidden"),f.call([{methodname:"mod_mooduell_load_finishedgames_data",args:{quizid:n,pageid:e,tsort:i,thide:t,tshow:a,tdir:s,treset:d},done:function(e){e=g(g.parseHTML(e.content));1!=e.length&&(m(0,e,"finishedgames"),c(n,e,o),h(n,e,o),u(n,e,o)),g("#spinner div").addClass("hidden"),g("#finishedgamestable").html(e),g("#finishedgamestable").removeClass("hidden")},fail:function(){alert("fail"),g("#spinner div").addClass("hidden"),g("#finishedgamestable").removeClass("hidden")}}])}function r(n,e=null,i=null,t=null,a=null,s=null,d=null){g("#spinner div").removeClass("hidden"),g("#highscorestable").addClass("hidden"),g("#spinner div").removeClass("hidden"),f.call([{methodname:"mod_mooduell_load_highscore_data",args:{quizid:n,pageid:e,tsort:i,thide:t,tshow:a,tdir:s,treset:d},done:function(e){e=g(g.parseHTML(e.content));1!=e.length&&(m(0,e,"highscores"),c(n,e,r),h(n,e,r),u(n,e,r)),g("#spinner div").addClass("hidden"),g("#highscorestable").html(e),g("#highscorestable").removeClass("hidden")},fail:function(){alert("fail"),g("#spinner div").addClass("hidden"),g("#highscorestable").removeClass("hidden")}}])}function h(n,e,i){e=e.find(".page-item");g.each(e,function(){var e=g(this).data("page-number");g(this).children("a").attr("href","#"),g(this).children("a").click(function(){i(n,e-1)})})}function u(a,e,s){e=e.find("th.header a");g.each(e,function(){var e=g(this).data("sortby"),n=g(this).data("sortorder"),i="hide"==g(this).data("action")?g(this).data("column"):null,t="show"==g(this).data("action")?g(this).data("column"):null,n=parseInt(n);g(this).attr("href","#"),g(this).click(function(){s(a,null,e,i,t,n)})})}function c(e,n,i){n.find("div.resettable").length,g.each(n,function(){0<=g(this).attr("class").indexOf("resettable")&&(g(this).children("a").attr("href","#"),g(this).children("a").click(function(){i(e,null,null,null,null,null,1)}))})}function m(e,n,i){var t=n.find("form");0==t.length&&(t=n),g.each(t,function(){var e;"FORM"==g(this).prop("tagName")&&(g(this).attr("action"),e=a("id"),g(this).append('<input type="hidden" name="quizid" value="'+e+'">'),g(this).append('<input type="hidden" name="action" value="'+i+'">'))})}g('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var n,e=(e=e.target.toString()).split("#");if(0!=e.length)switch(e[1]){case"highscores":r(a("id"));break;case"questions":n=a("id"),g("#spinner div").removeClass("hidden"),g("#questionstable").addClass("hidden"),g("#spinner div").removeClass("hidden"),f.call([{methodname:"mod_mooduell_load_questions_data",args:{quizid:n},done:function(e){var s="";e.forEach(e=>{var n="no image";e.imageurl&&0<e.imageurl.length&&(n='<a href="'+e.imageurl+'"><img src="'+e.imageurl+'" alt="'+e.imagetext+'" width="100px"></img></a>');var i=e.length;i&&0!=i.length||(i=e.questiontext.length);var t="<ul>";e.warnings.forEach(e=>{t+='<li><span style="color:red;">'+e.message+"</span></li>"}),t+="</ul>";var a="<ul>";e.answers.forEach(e=>{var n=0<e.fraction?' style="color: green;"':"";a+="<li><span"+n+">"+e.answertext+"</span></li>"}),s+='<tr><td><a href="../../question/question.php?returnurl=/question/edit.php?courseid='+e.courseid+"&courseid="+e.courseid+"&id="+e.questionid+'">'+e.questionid+"</a></td><td>"+n+'</td><td class="text-left">'+e.questiontext+(a+="</ul>")+'</td><td class="text-right">'+e.questiontype+'</td><td class="text-right">'+i+'</td><td class="text-right">'+e.category+'</td><td class="text-right">'+t+'</td><td class="text-right">'+e.status+"</td></tr>"}),g("#questionstable tbody").html(s),g("#spinner div").addClass("hidden"),g("#questionstable").removeClass("hidden")},fail:function(){g("#spinner div").addClass("hidden"),g("#questionstable").removeClass("hidden")}}]);break;case"opengames":l(a("id"));break;case"finishedgames":o(a("id"))}}),a("gameid")&&(g("#spinner div").addClass("hidden"),g("#questionstable").removeClass("hidden"))}}});